import { KuzzleRequest } from "kuzzle"
import parseCollections from "./parseCollections"
import taskHook from "./taskHook"
import companyHook from "./companyHook"

// search request
const request: KuzzleRequest = JSON.parse('{\"internalId\":\"0b09dfbb-027c-4a40-a91b-af1153601bf7\",\"status\":200,\"input\":{\"jwt\":\"kauth-eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiJrdWlkLXJhcmUtcGhvdG9qb3VybmFsaXN0LTMzMzQxIiwiaWF0IjoxNjk1MTk2ODYxLCJleHAiOjE2OTU4MDE2NjF9.NlG8pJjyWX4KwmyghKBBH9XcP1odhE7R2DDP2-usJLg\",\"volatile\":{\"sdkInstanceId\":\"96462ebe-4218-49cf-b769-ae2ffa7a7807\",\"sdkName\":\"js@7.11.0\"},\"body\":{\"query\":{\"match_all\":{}},\"sort\":[{\"content.name\":\"asc\"}]},\"controller\":\"document\",\"action\":\"search\",\"args\":{\"collection\":\"company_v1\",\"index\":\"startum_v1\",\"size\":100,\"lang\":\"koncorde\",\"requestId\":\"a2e47a9b-7a30-46d8-aea6-9dc7fd8d5290\",\"verb\":\"POST\",\"silent\":true},\"resource\":{\"args\":{\"collection\":\"company_v1\",\"index\":\"startum_v1\",\"size\":100,\"lang\":\"koncorde\",\"requestId\":\"a2e47a9b-7a30-46d8-aea6-9dc7fd8d5290\",\"verb\":\"POST\",\"silent\":true}},\"headers\":{\"host\":\"startum.kuzzle.d2.rolder.app\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Noodl/2.9.1 Chrome/112.0.5615.50 Electron/24.1.1 Safari/537.36\",\"accept-encoding\":\"gzip, deflate, br\",\"accept-language\":\"en-GB\",\"cache-control\":\"no-cache\",\"connection\":\"Upgrade\",\"origin\":\"http://localhost:8574\",\"pragma\":\"no-cache\",\"sec-websocket-extensions\":\"permessage-deflate; client_max_window_bits\",\"sec-websocket-key\":\"tdrMeD0ll5n89qZdajeaJA==\",\"sec-websocket-protocol\":\"null\",\"sec-websocket-version\":\"13\",\"upgrade\":\"websocket\",\"x-forwarded-for\":\"10.42.0.0\",\"x-forwarded-host\":\"startum.kuzzle.d2.rolder.app\",\"x-forwarded-port\":\"443\",\"x-forwarded-proto\":\"wss\",\"x-forwarded-server\":\"traefik-56b8c5fb5c-7j2rl\",\"x-real-ip\":\"10.42.0.0\"}},\"context\":{\"connection\":{\"id\":\"eee41fe4-d528-4319-b029-b6ee2af5eea6\",\"ips\":[\"0000:0000:0000:0000:0000:ffff:0a2a:0156\"],\"protocol\":\"websocket\",\"headers\":{\"host\":\"startum.kuzzle.d2.rolder.app\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Noodl/2.9.1 Chrome/112.0.5615.50 Electron/24.1.1 Safari/537.36\",\"accept-encoding\":\"gzip, deflate, br\",\"accept-language\":\"en-GB\",\"cache-control\":\"no-cache\",\"connection\":\"Upgrade\",\"origin\":\"http://localhost:8574\",\"pragma\":\"no-cache\",\"sec-websocket-extensions\":\"permessage-deflate; client_max_window_bits\",\"sec-websocket-key\":\"tdrMeD0ll5n89qZdajeaJA==\",\"sec-websocket-protocol\":\"null\",\"sec-websocket-version\":\"13\",\"upgrade\":\"websocket\",\"x-forwarded-for\":\"10.42.0.0\",\"x-forwarded-host\":\"startum.kuzzle.d2.rolder.app\",\"x-forwarded-port\":\"443\",\"x-forwarded-proto\":\"wss\",\"x-forwarded-server\":\"traefik-56b8c5fb5c-7j2rl\",\"x-real-ip\":\"10.42.0.0\"},\"internal\":{}},\"token\":{\"_id\":\"kuid-rare-photojournalist-33341#kauth-eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiJrdWlkLXJhcmUtcGhvdG9qb3VybmFsaXN0LTMzMzQxIiwiaWF0IjoxNjk1MTk2ODYxLCJleHAiOjE2OTU4MDE2NjF9.NlG8pJjyWX4KwmyghKBBH9XcP1odhE7R2DDP2-usJLg\",\"expiresAt\":1695801661823,\"ttl\":604800000,\"userId\":\"kuid-rare-photojournalist-33341\",\"jwt\":\"kauth-eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiJrdWlkLXJhcmUtcGhvdG9qb3VybmFsaXN0LTMzMzQxIiwiaWF0IjoxNjk1MTk2ODYxLCJleHAiOjE2OTU4MDE2NjF9.NlG8pJjyWX4KwmyghKBBH9XcP1odhE7R2DDP2-usJLg\",\"refreshed\":false,\"singleUse\":false},\"user\":{\"_id\":\"kuid-rare-photojournalist-33341\",\"profileIds\":[\"companyWriter\",\"companyReader\"],\"role\":{\"value\":\"admin\",\"title\":\"Startum\"},\"_kuzzle_info\":{\"author\":\"kuid-frustrating-archaeologist-85153\",\"createdAt\":1694945247231,\"updatedAt\":null,\"updater\":null}}},\"error\":null,\"result\":{\"hits\":[{\"_id\":\"cxS-sIoB80TOg2CiBCHE\",\"_score\":null,\"_source\":{\"content\":{\"name\":\"123123123\",\"contacts\":{\"phone\":\"81231231231\",\"email\":\"123123123@sdf.rr\"},\"legal\":{\"name\":\"123123123\",\"address\":\"123123123123123123\",\"rs\":\"12312312312312312312\",\"inn\":\"123123123123\",\"ogrn\":\"123123123123123\",\"bik\":\"123123123\",\"ks\":\"12312312312312312312\"},\"subscription\":{\"balance\":16000}},\"states\":{\"flow\":{\"value\":\"created\",\"label\":\""},\"subscription\":{\"value\":\"notRegistered\",\"label\":\""}},\"_kuzzle_info\":{\"author\":\"kuid-rare-photojournalist-33341\",\"createdAt\":1695182357698,\"updatedAt\":1695184463325,\"updater\":\"kuid-rare-photojournalist-33341\"}},\"collection\":\"company_v1\",\"index\":\"startum_v1\"},{\"_id\":\"Ztg_rYoB_5YkwXnIe0nV\",\"_score\":null,\"_source\":{\"content\":{\"name\":\"",\"contacts\":{\"phone\":\"85675674586\",\"email\":\"234@mail.ru\"},\"legal\":{\"name\":\"\",\"address\":\"654654, 567, 1234,  46, 777\",\"rs\":\"45657686797975678465\",\"inn\":\"456576867979\",\"ogrn\":\"456576867979756\",\"bik\":\"456576861\",\"ks\":\"45657686797975678465\"},\"subscription\":{\"date\":{\"start\":\"2023-09-11T12:21:34.908Z\",\"end\":\"2023-09-19T12:21:34.908Z\"},\"balance\":2000,\"dayCost\":50,\"count\":{\"area\":10,\"worker\":10}}},\"states\":{\"flow\":{\"value\":\"activated\",\"label\":\""},\"subscription\":{\"label\":\"",\"value\":\"activated\"}},\"_kuzzle_info\":{\"author\":\"kuid-frustrating-archaeologist-85153\",\"createdAt\":1695123733460,\"updatedAt\":1695124970091,\"updater\":\"kuid-rare-photojournalist-33341\"}},\"collection\":\"company_v1\",\"index\":\"startum_v1\"}],\"total\":2},\"response\":null,\"id\":\"a2e47a9b-7a30-46d8-aea6-9dc7fd8d5290\",\"timestamp\":1695196862225}')
// this.pipe.register
const collections = parseCollections(request)
collections?.forEach(collection => {
    const dbClass = collection.split('_')[0]
    if (dbClass === 'task') return taskHook(undefined, collection, request)
    if (dbClass === 'company') return companyHook(undefined, collection, request)
   console.log(companyHook(undefined, collection, request))
    return request
})