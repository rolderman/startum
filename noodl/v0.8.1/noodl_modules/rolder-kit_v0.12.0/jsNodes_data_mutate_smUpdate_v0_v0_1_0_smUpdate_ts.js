(self.webpackChunkrolder_kit=self.webpackChunkrolder_kit||[]).push([["jsNodes_data_mutate_smUpdate_v0_v0_1_0_smUpdate_ts"],{980326:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return s}});var r=a("12763"),d=a("666767"),u=a("550277"),s={update:e=>{let{updateScheme:t,optimistic:a}=e._inputValues;(0,u.sendOutput)(e,"updating",!0);let s=e=>(0,r.default)(e,a),n=e=>(0,d.default)(e,a);t&&Promise.all(t.map(e=>"user"===e.dbClass?e.items.map(e=>n(e)):s(e))).then(t=>{(0,u.sendOutput)(e,"updatedData",t),(0,u.sendSignal)(e,"updated"),(0,u.sendOutput)(e,"updating",!1)})}}},501194:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return function e(t){let a={};if(t&&"object"==typeof t)return(0,d.default)(t,(t,d)=>{if("object"!=typeof d||Array.isArray(d))Array.isArray(d)?d.forEach(r=>{let d=e(r);d?.length&&(a[t]=a[t]?[...a[t],d]:[d])}):d&&(a[t]=d);else if(!(0,r.default)(d)){let u=e(d);!(0,r.default)(u)&&(a[t]=u)}}),a;if(t)return t;if(Array.isArray(t))throw Error(`It is array, object expected: ${t}`)}}});var r=a("939711"),d=a("309317")},12763:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return f}});var r=a("516244"),d=a("995929"),u=a("650887"),s=a("501194"),n=a("528957"),l=a("687803");let i=async(e,t)=>{let{Kuzzle:a}=window,{dbClass:i,items:f}=e,o=(0,u.setOptions)(i),c=(0,l.dbClassVersion)(i),p=f.map(e=>(e._id=e.id,(0,s.default)(e))),m=[];return t&&(m=(0,n.default)(i,p.map(e=>({id:e.id,...e.body})))),(0,r.default)(`${c} mUpdate`,"time"),(0,r.default)([`${c} props: `,{dbClass:i,flushedItems:p,options:o}]),a.connect().then(()=>a.document.mUpdate((0,l.dbVersion)(),c,p,{...o,retryOnConflict:3}).then(e=>(!t&&(m=(0,n.default)(i,p.map(e=>({id:e.id,...e.body})))),e.errors.length>0&&(0,d.default)({title:"Системная ошибка!",message:"Kuzzle mUpdate errors at dbClass "+c+": "+JSON.stringify(e.errors)}),(0,r.default)([`${c} mUpdated: `,m]),(0,r.default)(`${c} mUpdate`,"timeEnd"),m)).catch(e=>(0,d.default)({title:"Системная ошибка!",message:"Kuzzle mUpdate "+c+": "+e.message})))};var f=i},666767:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return i}});var r=a("516244"),d=a("995929"),u=a("650887"),s=a("501194"),n=a("528957");let l=async(e,t)=>{let{Kuzzle:a}=window,{id:l,body:i}=e,f=(0,u.setOptions)("user"),o=(0,s.default)(i),c={};t&&(c=n.default("user",[{id:l,...o}])?.[0]);let p={...i.content,credentials:{local:{notSecret:i.credentials?.local.notSecret}}};return(0,r.default)("UpdateUser","time"),(0,r.default)(["Props: ",{id:l,flushedBody:o,options:f}]),a.connect().then(()=>a.security.updateCredentials("local",l,i.credentials?.local).then(()=>a.security.updateUser(l,p,f).then(()=>(!t&&(c=n.default("user",[{id:l,...o}])?.[0]),c))).catch(e=>(0,d.default)({title:"Системная ошибка!",message:"Kuzzle updateUser : "+e.message})))};var i=l}}]);
//# sourceMappingURL=jsNodes_data_mutate_smUpdate_v0_v0_1_0_smUpdate_ts.js.map